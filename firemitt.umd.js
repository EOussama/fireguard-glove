(function(a,d){typeof exports=="object"&&typeof module<"u"?d(exports):typeof define=="function"&&define.amd?define(["exports"],d):(a=typeof globalThis<"u"?globalThis:a||self,d(a.Firemitt={}))})(this,function(a){"use strict";var $=Object.defineProperty;var E=(a,d,n)=>d in a?$(a,d,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[d]=n;var F=(a,d,n)=>(E(a,typeof d!="symbol"?d+"":d,n),n);var d=(r=>(r[r.Loaded=0]="Loaded",r[r.Config=1]="Config",r[r.AuthSucceded=2]="AuthSucceded",r[r.AuthFailed=3]="AuthFailed",r))(d||{}),n=(r=>(r[r.InvalidURL=1]="InvalidURL",r[r.InvalidApp=2]="InvalidApp",r[r.InvalidAppName=3]="InvalidAppName",r[r.InvalidProvider=4]="InvalidProvider",r[r.InvalidFirebaseConfig=5]="InvalidFirebaseConfig",r))(n||{});class m extends Error{constructor(t,s){super(s);F(this,"type");this.type=t,this.name=`${y.getName(n,t)}Error`??"BaseError"}toString(){return`[${this.name}] ${this.message}.`}toObject(){return{type:this.type,name:this.name,message:this.message}}}class c extends m{constructor(){super(n.InvalidURL,"Invalid URL name, please specify a valid URL for a Fireguard instance")}}class P extends m{constructor(){super(n.InvalidApp,"Invalid Firebase app, failed initializing fire base with the given configuration")}}class A extends m{constructor(){super(n.InvalidAppName,"Invalid app name, please specify a name for your app")}}class j extends m{constructor(e){super(n.InvalidProvider,`Invalid provider, "${e}" is not a valid provider name`)}}class L extends m{constructor(){super(n.InvalidFirebaseConfig,"Invalid Firebase configuration")}}class y{static getName(e,t){return Object.keys(e).find(i=>e[i]===t)}}class v{static init(e){return this.target=e,!!this.target}static send(e,t){const s={...t},i={type:e,payload:s},u=w.encode(i);return this.target.postMessage(u,"*"),this}static on(e,t){const s=i=>{if(i.isTrusted){const u=w.decode(i.data);u.type===e&&(t(u.payload),window.removeEventListener("message",s))}};return window.addEventListener("message",s),this}}F(v,"target");class o{static getDim(e,t){const s=parseFloat((e??450).toString()),i=parseFloat((t??260).toString());return{width:s,height:i}}static getPos(e,t,s){const i=parseFloat((t??50).toString());return{x:parseFloat((e??window.screen.width/2-s/2).toString()),y:i}}static getURL(e){try{const t=new URL(e??"");if(t.protocol!=="http:"&&t.protocol!=="https:")throw Error();return t.toString()}catch{throw new c}}static getFireguardConfig(e,t){var l,p,I,S,b,C,g,R,U,N;const s=(e==null?void 0:e.name)??"",i=(e==null?void 0:e.logo)??"",u={text:((l=e==null?void 0:e.theme)==null?void 0:l.text)||(t==null?void 0:t.text)||"#1a3544",primary:((p=e==null?void 0:e.theme)==null?void 0:p.primary)||(t==null?void 0:t.primary)||"#ffe536",secondary:((I=e==null?void 0:e.theme)==null?void 0:I.secondary)||(t==null?void 0:t.secondary)||"#1a3544"},h=(e==null?void 0:e.firebase)??{apiKey:((S=e==null?void 0:e.firebase)==null?void 0:S.apiKey)??"",appId:((b=e==null?void 0:e.firebase)==null?void 0:b.appId)??"",projectId:((C=e==null?void 0:e.firebase)==null?void 0:C.projectId)??"",authDomain:((g=e==null?void 0:e.firebase)==null?void 0:g.authDomain)??"",measurementId:((R=e==null?void 0:e.firebase)==null?void 0:R.measurementId)??"",storageBucket:((U=e==null?void 0:e.firebase)==null?void 0:U.storageBucket)??"",messagingSenderId:((N=e==null?void 0:e.firebase)==null?void 0:N.messagingSenderId)??""};if(s.length===0)throw new A;if(Object.keys(h).length===0)throw new L;return{name:s,logo:i,theme:u,firebase:h}}static init(e){var h,l,p,I;const t=this.getURL(e.url),s=this.getDim((h=e==null?void 0:e.dim)==null?void 0:h.width,(l=e==null?void 0:e.dim)==null?void 0:l.height),i=this.getPos((p=e==null?void 0:e.pos)==null?void 0:p.x,(I=e==null?void 0:e.pos)==null?void 0:I.y,s.width),u=this.getFireguardConfig(e==null?void 0:e.config);return{url:t,dim:s,pos:i,fireguard:u}}static getFlags(e){return[`width=${e.dim.width}`,`height=${e.dim.height}`,`left=${e.pos.x}`,`top=${e.pos.y}`].join(",")}}class w{static encode(e){const t=JSON.stringify(e);return btoa(t)}static decode(e){const t=atob(e);return JSON.parse(t)}}class B{static auth(e){const t=o.init(e),s=o.getFlags(t),i=window.open(t.url,"_blank",s);return new Promise((u,h)=>{v.init(i)&&v.on(d.Loaded,()=>{v.send(d.Config,t.fireguard).on(d.AuthSucceded,({token:l})=>u(l)).on(d.AuthFailed,({error:l})=>h(l))})})}}a.Base64helper=w,a.BaseError=m,a.ConfigHelper=o,a.EnumHelper=y,a.ErrorType=n,a.EventHelper=v,a.EventType=d,a.FiremittHelper=B,a.InvalidAppError=P,a.InvalidAppNameError=A,a.InvalidFirebaseConfigError=L,a.InvalidProviderError=j,a.InvalidURLError=c,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
